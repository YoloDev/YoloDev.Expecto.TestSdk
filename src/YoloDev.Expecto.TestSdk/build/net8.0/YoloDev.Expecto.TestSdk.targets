<Project>

  <!-- Handle the coexistance between Microsoft.Testing.Platform and Microsoft.NET.Test.Sdk  -->
  <PropertyGroup>
    <!-- Makes the new platform/runner opt-in feature -->
    <EnableExpectoTestingPlatformIntegration Condition=" '$(EnableExpectoTestingPlatformIntegration)' == '' ">false</EnableExpectoTestingPlatformIntegration>

    <IsTestingPlatformApplication>$(EnableExpectoTestingPlatformIntegration)</IsTestingPlatformApplication>
    <GenerateProgramFile Condition=" '$(EnableExpectoTestingPlatformIntegration)' == 'true' ">false</GenerateProgramFile>
  </PropertyGroup>

  <Choose>
    <!-- Avoid false warning about missing reference (msbuild bug) -->
    <!-- https://github.com/dotnet/msbuild/issues/9698#issuecomment-1945763467 -->
    <When Condition=" '$(EnableExpectoTestingPlatformIntegration)' == 'true' ">
      <ItemGroup>
        <Reference Include="expecto.visualstudio.dotnetcore.testadapter">
          <HintPath>$(MSBuildThisFileDirectory)expecto.visualstudio.dotnetcore.testadapter.dll</HintPath>
        </Reference>
      </ItemGroup>
    </When>
    <Otherwise>
      <ItemGroup>
        <None Include="$(MSBuildThisFileDirectory)expecto.visualstudio.dotnetcore.testadapter.dll">
          <Link>expecto.visualstudio.dotnetcore.testadapter.dll</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
          <Visible>False</Visible>
        </None>
      </ItemGroup>
    </Otherwise>
  </Choose>

</Project>
